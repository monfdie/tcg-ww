<%- include('../partials/header') %>

<style>
    /* --- –°–¢–ò–õ–ò –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´ --- */
    .hero-section {
        text-align: center;
        margin-top: 40px;
        margin-bottom: 60px;
        animation: fadeIn 1s ease-out;
    }
    
    .main-title {
        font-family: 'Cinzel', serif;
        font-size: 3.5em;
        color: #fff;
        margin: 0;
        text-shadow: 0 0 20px rgba(79, 172, 254, 0.5);
        letter-spacing: 2px;
    }

    /* --- –ù–û–í–ê–Ø –°–ï–¢–ö–ê (3 –ü–û–°–¢–ê –í –†–Ø–î) --- */
    .news-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* –†–æ–≤–Ω–æ 3 –∫–æ–ª–æ–Ω–∫–∏ */
        gap: 30px;
        padding: 0 20px;
        max-width: 1400px; /* –£–≤–µ–ª–∏—á–∏–ª–∏ —à–∏—Ä–∏–Ω—É, —á—Ç–æ–±—ã –≤–º–µ—Å—Ç–∏—Ç—å 3 –∫–∞—Ä—Ç–æ—á–∫–∏ */
        margin: 0 auto;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å: –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–∞—Ö 2, –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö 1 */
    @media (max-width: 1100px) {
        .news-container { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 768px) {
        .news-container { grid-template-columns: 1fr; }
    }

    /* --- –î–ò–ó–ê–ô–ù –ö–ê–†–¢–û–ß–ï–ö --- */
    .news-card {
        background: rgba(22, 28, 48, 0.85);
        border: 1px solid #2a3454;
        border-radius: 12px;
        width: auto; /* –®–∏—Ä–∏–Ω–∞ —Ç–µ–ø–µ—Ä—å —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–µ—Ç–∫–æ–π */
        max-width: none; /* –£–±–∏—Ä–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ */
        min-height: 320px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã */
        padding: 40px 30px;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        text-decoration: none;
    }

    .news-card:hover {
        transform: translateY(-5px);
    }

    /* --- –ó–û–õ–û–¢–ê–Ø –ö–ê–†–¢–û–ß–ö–ê (GITCG CUP) --- */
    .cup-card {
        border: 1px solid #d4af37;
        background: radial-gradient(circle at center, rgba(212, 175, 55, 0.15) 0%, rgba(22, 28, 48, 1) 80%);
        box-shadow: 0 0 30px rgba(212, 175, 55, 0.15);
    }
    .cup-card:hover {
        box-shadow: 0 0 50px rgba(212, 175, 55, 0.3);
        border-color: #f2d06b;
    }
    .cup-glow {
        position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
        background: radial-gradient(circle, rgba(212, 175, 55, 0.08) 0%, transparent 60%);
        animation: rotateGlow 15s linear infinite; pointer-events: none; z-index: 0;
    }

    /* --- –û–ë–´–ß–ù–ê–Ø –ö–ê–†–¢–û–ß–ö–ê (–°–ò–ù–Ø–Ø) --- */
    .live-card { border-top: 4px solid #4facfe; }
    .live-card:hover { border-color: #4facfe; box-shadow: 0 15px 40px rgba(79, 172, 254, 0.2); }

    /* --- –ë–ï–ô–î–ñ–ò–ö–ò --- */
    .badge {
        position: absolute; top: 20px; right: 20px; padding: 6px 14px; border-radius: 20px;
        font-family: 'Segoe UI', sans-serif; font-size: 0.8em; font-weight: bold; letter-spacing: 1px;
        z-index: 2; text-transform: uppercase;
    }
    .badge-soon { background: rgba(212, 175, 55, 0.2); color: #d4af37; border: 1px solid rgba(212, 175, 55, 0.4); }
    .badge-live { background: rgba(40, 167, 69, 0.2); color: #28a745; border: 1px solid rgba(40, 167, 69, 0.4); animation: pulseGreen 2s infinite; }

    /* --- –¢–ï–ö–°–¢–´ –ò –ö–ù–û–ü–ö–ò --- */
    .card-title {
        font-family: 'Cinzel', serif; font-size: 2em; margin: 10px 0 20px 0; color: #fff; z-index: 1; position: relative; text-align: center;
        /* –ï—Å–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª–∏–Ω–Ω–æ–µ, –æ–Ω–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –ª–æ–º–∞—Ç—å —Å–µ—Ç–∫—É */
        word-wrap: break-word;
    }
    
    .tour-details { background: rgba(10, 12, 20, 0.5); padding: 15px; border-radius: 6px; border: 1px solid #1e2640; margin-bottom: 25px; font-size: 0.95em; }
    .tour-row { display: flex; justify-content: space-between; margin-bottom: 8px; }
    .tour-label { color: #889; }
    .tour-value { color: #fff; font-weight: 500; }
    .tour-prize { color: #d4af37; font-weight: bold; }

    .home-action-btn { display: block; width: 100%; padding: 16px 0; border-radius: 50px; font-family: 'Segoe UI', sans-serif; font-size: 1.1em; font-weight: bold; text-align: center; text-decoration: none !important; text-transform: uppercase; letter-spacing: 2px; transition: all 0.3s ease; box-sizing: border-box; border: 2px solid transparent; cursor: pointer; z-index: 2; position: relative; }
    .btn-gold { color: #0b0d17 !important; background: linear-gradient(45deg, #d4af37, #f2d06b); border: none; box-shadow: 0 0 15px rgba(212, 175, 55, 0.3); }
    .btn-gold:hover { box-shadow: 0 0 30px rgba(212, 175, 55, 0.6); transform: scale(1.02); color: #000 !important; }
    .btn-blue { color: #4facfe; border-color: #4facfe; background: rgba(79, 172, 254, 0.1); }
    .btn-blue:hover { background: #4facfe; color: #0b0d17 !important; box-shadow: 0 0 20px rgba(79, 172, 254, 0.5); }
    .pulse-text { display: block; text-align: center; color: #d4af37; font-weight: bold; letter-spacing: 2px; margin-top: 15px; font-size: 0.85em; animation: pulseAlpha 2s infinite; opacity: 0.8; }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(5px); z-index: 1000; align-items: center; justify-content: center; animation: fadeIn 0.3s; }
    .modal-box { background: #161c30; border: 1px solid #d4af37; width: 90%; max-width: 600px; padding: 30px; border-radius: 8px; position: relative; box-shadow: 0 0 50px rgba(212, 175, 55, 0.15); display: flex; flex-direction: column; gap: 15px; }
    .modal-close { position: absolute; top: 15px; right: 20px; color: #888; font-size: 24px; cursor: pointer; }
    .modal-title { font-family: 'Cinzel', serif; font-size: 2em; color: #fff; margin: 0; border-bottom: 1px solid #333; padding-bottom: 10px; }
    .modal-btn { display: block; width: 100%; text-align: center; padding: 15px; background: #d4af37; color: #000; font-weight: bold; text-decoration: none; border-radius: 4px; margin-top: 10px; transition: 0.2s; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes rotateGlow { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes pulseAlpha { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
    @keyframes pulseGreen { 0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); } 100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); } }
</style>

<div class="hero-section">
    <h1 class="main-title">Genshin Impact TCG</h1>
</div>

<div class="news-container">
    
    <div class="news-card cup-card">
        <div class="cup-glow"></div>
        <div class="badge badge-soon">SOON</div>
        
        <div style="flex-grow: 1; display: flex; align-items: center; justify-content: center; min-height: 150px; position: relative; z-index: 1;">
            <h2 class="card-title" style="color: #d4af37; font-size: 2.8em; text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);">
                GITCG CUP 2
            </h2>
        </div>
        
        <div style="margin-top: auto; position: relative; z-index: 1;">
            <a href="/create" class="home-action-btn btn-gold">Practice Draft</a>
            <span class="pulse-text">PREPARE YOUR DECKS</span>
        </div>
    </div>

    <% if (locals.news && news.length > 0) { %>
        <% news.forEach(item => { %>
            
            <% 
               const isNews = item.type === 'announcement'; // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–æ–≤–æ—Å—Ç—å –ª–∏ —ç—Ç–æ
               
               let clickAction = '';
               let hrefAttr = '';
               let targetAttr = '_self';
               if (item.openInModal) {
                   clickAction = `onclick="openModal(this)"`;
                   hrefAttr = 'javascript:void(0)';
               } else {
                   hrefAttr = item.regLink || '#';
                   if (item.regLink && item.regLink.startsWith('http')) targetAttr = '_blank';
               }
            %>

            <a href="<%= hrefAttr %>" target="<%= targetAttr %>" class="news-card live-card" 
               <%= clickAction %>
               data-title="<%= item.title %>"
               data-date="<%= item.date %>"
               data-prize="<%= item.prize %>"
               data-region="<%= item.region %>"
               data-desc="<%= item.description %>"
               data-link="<%= item.regLink %>">
               
               <% if (item.image) { %>
                   <img src="/uploads/<%= item.image %>" style="width: 100%; height: 100%; object-fit: cover; position: absolute; top:0; left:0; opacity: 0.6; transition: 0.3s;">
                   
                   <div style="position: relative; z-index: 2; padding: 20px; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);">
                       
                       <% if (!isNews) { %>
                           <div class="badge badge-live" style="position: absolute; top: 20px; right: 20px;"><%= item.badgeText %></div>
                       <% } %>

                       <h2 class="card-title" style="font-size: 1.8em; text-shadow: 0 2px 10px black; text-align: left;"><%= item.title %></h2>
                       
                       <% if (item.date) { %>
                           <div style="color: #ccc; margin-top: 5px;"><%= item.date %></div>
                       <% } %>
                   </div>

               <% } else { %>
                   <% if (!isNews) { %>
                       <div class="badge badge-live"><%= item.badgeText %></div>
                   <% } %>

                   <h2 class="card-title"><%= item.title %></h2>
                   
                   <div class="tour-details">
                       <% if (item.date) { %>
                           <div class="tour-row"><span class="tour-label">Date:</span><span class="tour-value"><%= item.date %></span></div>
                       <% } %>

                       <% if (item.prize) { %>
                           <div class="tour-row"><span class="tour-label">Prize:</span><span class="tour-value tour-prize"><%= item.prize %></span></div>
                       <% } %>
                   </div>

                   <div style="margin-top: auto;">
                       <span class="home-action-btn btn-blue">Details</span>
                   </div>
               <% } %>
            </a>

        <% }); %>
    <% } %>

</div>

<div id="infoModal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal-box">
        <span class="modal-close" onclick="closeModalDirect()">√ó</span>
        <h2 id="m-title" class="modal-title">Title</h2>
        <div style="display: flex; gap: 15px; color: #8da4c4; font-size: 0.9em; margin-bottom: 10px;">
            <span>üìÖ <span id="m-date">-</span></span>
            <span>üèÜ <span id="m-prize">-</span></span>
            <span>üåç <span id="m-region">-</span></span>
        </div>
        <div id="m-desc" style="color: #ccc; line-height: 1.6; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 4px; max-height: 300px; overflow-y: auto; white-space: pre-wrap;"></div>
        <a id="m-link" href="#" target="_blank" class="modal-btn">GO TO LINK</a>
    </div>
</div>

<script>
    function openModal(element) {
        document.getElementById('m-title').innerText = element.getAttribute('data-title');
        document.getElementById('m-date').innerText = element.getAttribute('data-date') || '-';
        document.getElementById('m-prize').innerText = element.getAttribute('data-prize') || '-';
        document.getElementById('m-region').innerText = element.getAttribute('data-region') || 'Global';
        document.getElementById('m-desc').innerText = element.getAttribute('data-desc') || 'No description.';
        document.getElementById('m-link').href = element.getAttribute('data-link') || '#';
        document.getElementById('infoModal').style.display = 'flex';
    }
    function closeModal(event) { if (event.target.id === 'infoModal') closeModalDirect(); }
    function closeModalDirect() { document.getElementById('infoModal').style.display = 'none'; }
</script>

<%- include('../partials/footer') %>
