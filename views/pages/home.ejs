<%- include('../partials/header') %>

<style>
    /* --- –í–ê–®–ò –°–¢–ê–†–´–ï –°–¢–ò–õ–ò --- */
    .hero-section { text-align: center; margin-top: 40px; margin-bottom: 60px; animation: fadeIn 1s ease-out; }
    .main-title { font-family: 'Cinzel', serif; font-size: 3.5em; color: #fff; margin: 0; text-shadow: 0 0 20px rgba(79, 172, 254, 0.5); letter-spacing: 2px; }
    .news-container { display: flex; justify-content: center; gap: 40px; flex-wrap: wrap; padding: 0 20px; }
    
    /* –°—Ç–∏–ª–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ (—Å–æ–∫—Ä–∞—â–µ–Ω–Ω–æ, –æ–Ω–∏ —É –≤–∞—Å –µ—Å—Ç—å) */
    .news-card { background: rgba(22, 28, 48, 0.85); border: 1px solid #2a3454; border-radius: 8px; width: 100%; max-width: 450px; padding: 40px 35px; position: relative; overflow: hidden; display: flex; flex-direction: column; transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.5); cursor: pointer; }
    .news-card:hover { transform: translateY(-5px); }
    
    /* ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∞—à–∏ —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫, –±–µ–π–¥–∂–µ–π –∏ —Ç.–¥. –æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –±—ã–ª–∏) ... */
    
    /* --- –°–¢–ò–õ–ò –î–õ–Ø –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê (POPUP) --- */
    .modal-overlay {
        display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px);
        z-index: 1000; align-items: center; justify-content: center;
        animation: fadeIn 0.3s;
    }
    .modal-box {
        background: #161c30; border: 1px solid #d4af37;
        width: 90%; max-width: 600px; padding: 30px;
        border-radius: 8px; position: relative;
        box-shadow: 0 0 40px rgba(212, 175, 55, 0.2);
        display: flex; flex-direction: column; gap: 15px;
    }
    .modal-close {
        position: absolute; top: 15px; right: 20px;
        color: #888; font-size: 24px; cursor: pointer; transition: 0.2s;
    }
    .modal-close:hover { color: #fff; }
    
    .modal-title { font-family: 'Cinzel', serif; font-size: 2em; color: #fff; margin: 0; border-bottom: 1px solid #333; padding-bottom: 10px; }
    .modal-meta { display: flex; gap: 15px; color: #8da4c4; font-size: 0.9em; flex-wrap: wrap; }
    .modal-desc { color: #ccc; line-height: 1.6; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 4px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; }
    .modal-btn { display: block; width: 100%; text-align: center; padding: 15px; background: #d4af37; color: #000; font-weight: bold; text-decoration: none; border-radius: 4px; margin-top: 10px; transition: 0.2s; }
    .modal-btn:hover { background: #f2d06b; box-shadow: 0 0 15px rgba(212, 175, 55, 0.4); }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>

<div class="hero-section">
    <h1 class="main-title">Genshin Impact TCG</h1>
</div>

<div class="news-container">
    
    <div class="news-card cup-card">
        <div class="cup-glow"></div>
        <div class="badge badge-soon">SOON</div>
        <div style="flex-grow: 1; display: flex; align-items: center; justify-content: center; min-height: 150px;">
            <h2 class="card-title" style="color: #d4af37; font-size: 2.5em; text-align: center; margin: 0; text-shadow: 0 0 15px rgba(212, 175, 55, 0.3);">GITCG CUP 2</h2>
        </div>
        <div style="margin-top: auto;">
            <a href="/create" class="home-action-btn btn-gold">Practice Draft</a>
            <span class="pulse-text">MORE DETAILS SOON</span>
        </div>
    </div>

    <% if (locals.news && news.length > 0) { %>
        <% news.forEach(item => { %>
            
            <% 
               let clickAction = '';
               let hrefAttr = '';
               let targetAttr = '_self';
               
               if (item.openInModal) {
                   // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –º–æ–¥–∞–ª–∫–∞ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –∞—Ç—Ä–∏–±—É—Ç—ã
                   clickAction = `onclick="openModal(this)"`;
                   hrefAttr = 'javascript:void(0)'; // –ß—Ç–æ–±—ã —Å—Å—ã–ª–∫–∞ –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–ª–∞
               } else {
                   // –û–±—ã—á–Ω–∞—è —Å—Å—ã–ª–∫–∞
                   hrefAttr = item.regLink;
                   if (item.regLink && item.regLink.startsWith('http')) targetAttr = '_blank';
               }
            %>

            <a href="<%= hrefAttr %>" target="<%= targetAttr %>" class="news-card" 
               style="text-decoration: none;"
               <%= clickAction %>
               data-title="<%= item.title %>"
               data-date="<%= item.date %>"
               data-prize="<%= item.prize %>"
               data-region="<%= item.region %>"
               data-desc="<%= item.description %>"
               data-link="<%= item.regLink %>">
               
               <% if (item.image) { %>
                   <img src="/uploads/<%= item.image %>" style="width: 100%; height: 100%; object-fit: cover; position: absolute; top:0; left:0; opacity: 0.6; transition: 0.3s;">
                   <div style="position: relative; z-index: 2; padding: 25px; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);">
                       <div class="badge badge-live" style="position: absolute; top: 20px; right: 20px;"><%= item.badgeText %></div>
                       <h2 class="card-title" style="font-size: 2em; text-shadow: 0 2px 10px black;"><%= item.title %></h2>
                       <div style="color: #ccc; margin-top: 5px;"><%= item.date %></div>
                   </div>
               <% } else { %>
                   <div class="badge badge-live"><%= item.badgeText %></div>
                   <h2 class="card-title" style="color: #fff;"><%= item.title %></h2>
                   <div class="tour-details">
                       <div class="tour-row"><span class="tour-label">Date:</span><span class="tour-value"><%= item.date %></span></div>
                       <% if (item.prize) { %>
                           <div class="tour-row"><span class="tour-label">Prize:</span><span class="tour-value tour-prize"><%= item.prize %></span></div>
                       <% } %>
                   </div>
               <% } %>
            </a>

        <% }); %>
    <% } %>

</div>

<div id="infoModal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal-box">
        <span class="modal-close" onclick="closeModalDirect()">√ó</span>
        
        <h2 id="m-title" class="modal-title">Tournament Title</h2>
        
        <div class="modal-meta">
            <span>üìÖ <span id="m-date">Date</span></span>
            <span>üèÜ <span id="m-prize">Prize</span></span>
            <span>üåç <span id="m-region">Region</span></span>
        </div>

        <div id="m-desc" class="modal-desc">
            Description goes here...
        </div>

        <a id="m-link" href="#" target="_blank" class="modal-btn">REGISTER NOW</a>
    </div>
</div>

<script>
    function openModal(element) {
        // –î–æ—Å—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∫–∞—Ä—Ç–æ—á–∫–∏
        const title = element.getAttribute('data-title');
        const date = element.getAttribute('data-date');
        const prize = element.getAttribute('data-prize');
        const region = element.getAttribute('data-region');
        const desc = element.getAttribute('data-desc');
        const link = element.getAttribute('data-link');

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        document.getElementById('m-title').innerText = title;
        document.getElementById('m-date').innerText = date || '-';
        document.getElementById('m-prize').innerText = prize || '-';
        document.getElementById('m-region').innerText = region || 'Global';
        document.getElementById('m-desc').innerText = desc || 'No additional details provided.';
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        const btn = document.getElementById('m-link');
        btn.href = link;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ
        document.getElementById('infoModal').style.display = 'flex';
    }

    function closeModal(event) {
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º, –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –ø–æ —Ç–µ–º–Ω–æ–º—É —Ñ–æ–Ω—É (overlay)
        if (event.target.id === 'infoModal') {
            document.getElementById('infoModal').style.display = 'none';
        }
    }
    
    function closeModalDirect() {
        document.getElementById('infoModal').style.display = 'none';
    }
</script>

<%- include('../partials/footer') %>
