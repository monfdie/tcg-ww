<%- include('../partials/header') %>

<div class="page-container">

    <div class="filters-container">
        <span style="color: #8da4c4; margin-right: 10px; font-size: 0.9em;">Filters:</span>
        <button class="filter-pill" onclick="toggleFilter('AS', this)">AS</button>
        <button class="filter-pill" onclick="toggleFilter('NA', this)">NA</button>
        <button class="filter-pill" onclick="toggleFilter('EU', this)">EU</button>
        <button class="filter-pill" onclick="toggleFilter('Draft', this)">Draft</button>
        <button class="filter-pill" onclick="toggleFilter('Allpick', this)">All pick</button>
        <button class="filter-pill reset-btn" onclick="resetFilters()">Reset</button>
    </div>

    <div class="section-header">
        <div class="live-indicator"></div>
        <h2>Live Events</h2>
    </div>

    <div class="tournament-list" id="list-active">
        <% if (tournaments && tournaments.length > 0) { %>
            <% tournaments.forEach(tour => { %>
                <a href="<%= (tour.regLink && tour.regLink.startsWith('http')) ? tour.regLink : '/tournament/' + tour.slug %>" 
                   class="tour-rect-card" 
                   target="<%= (tour.regLink && tour.regLink.startsWith('http')) ? '_blank' : '_self' %>"
                   data-tags="<%= tour.region %> <%= tour.system %>">
                    
                    <div class="card-image-block">
                        <img src="/logo.png" alt="Icon"> 
                    </div>

                    <div class="card-center">
                        <div class="card-title"><%= tour.title %></div>
                        <div class="card-hashtags">
                            <span>#<%= tour.slug %></span>
                            <span>#<%= tour.region %></span>
                            <span>#<%= tour.system %></span>
                        </div>
                    </div>

                    <div class="card-right">
                        <div class="info-group">
                            <label>Draft system</label>
                            <span><%= tour.system %></span>
                        </div>
                        <div class="info-group">
                            <label>Prize</label>
                            <span class="prize-text">üèÜ <%= tour.prize %></span>
                        </div>
                    </div>
                </a>
            <% }); %>
        <% } else { %>
            <div class="empty-state">No active tournaments.</div>
        <% } %>
    </div>

    <div class="section-header" style="margin-top: 40px;">
        <h2 style="color: #8da4c4;">Archive</h2>
    </div>

    <div class="tournament-list" id="list-archive">
        <% if (archive && archive.length > 0) { %>
            <% archive.forEach(tour => { %>
                <a href="<%= (tour.regLink && tour.regLink.startsWith('http')) ? tour.regLink : '/tournament/' + tour.slug %>" 
                   class="tour-rect-card archive-style" 
                   target="<%= (tour.regLink && tour.regLink.startsWith('http')) ? '_blank' : '_self' %>"
                   data-tags="<%= tour.region %> <%= tour.system %>">
                    
                    <div class="card-image-block grayscale">
                        <img src="/logo.png" alt="Icon">
                    </div>

                    <div class="card-center">
                        <div class="card-title"><%= tour.title %></div>
                        <div class="card-hashtags">
                            <span>#<%= tour.slug %></span>
                            <span>#<%= tour.date %></span>
                        </div>
                    </div>

                    <div class="card-right">
                        <div class="info-group">
                            <label>System</label>
                            <span><%= tour.system %></span>
                        </div>
                        <div class="info-group">
                            <label>Prize</label>
                            <span class="prize-text">üèÜ <%= tour.prize %></span>
                        </div>
                    </div>
                </a>
            <% }); %>
        <% } else { %>
            <div class="empty-state">Archive is empty.</div>
        <% } %>
    </div>

</div>

<style>
    /* --- –§–ò–õ–¨–¢–†–´ (–û–í–ê–õ–´) --- */
    .filters-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }
    .filter-pill {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid #3c4566;
        color: #8da4c4;
        padding: 6px 16px;
        border-radius: 20px; /* –û–≤–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ */
        cursor: pointer;
        font-family: 'Segoe UI', sans-serif;
        font-size: 0.9em;
        transition: 0.2s;
    }
    .filter-pill:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
    }
    .filter-pill.active {
        background: #4facfe;
        color: #0b0d17;
        border-color: #4facfe;
        font-weight: bold;
    }
    .reset-btn {
        border-color: #ff6b6b;
        color: #ff6b6b;
    }
    .reset-btn:hover {
        background: #ff6b6b;
        color: white;
    }

    /* --- –ó–ê–ì–û–õ–û–í–ö–ò –†–ê–ó–î–ï–õ–û–í --- */
    .section-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        border-bottom: 1px solid #2a3454;
        padding-bottom: 10px;
    }
    .section-header h2 {
        font-family: 'Segoe UI', sans-serif;
        font-size: 1.2em;
        margin: 0;
        color: #fff;
    }
    .live-indicator {
        width: 8px;
        height: 8px;
        background: #ff4444;
        border-radius: 50%;
        box-shadow: 0 0 10px #ff4444;
    }

    /* --- –ö–ê–†–¢–û–ß–ö–ê –¢–£–†–ù–ò–†–ê (–ü–†–Ø–ú–û–£–ì–û–õ–¨–ù–ò–ö) --- */
    .tournament-list {
        display: flex;
        flex-direction: column;
        gap: 8px; /* –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ */
    }

    .tour-rect-card {
        display: flex;
        align-items: center;
        background: #161c30; /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ */
        border: 1px solid #2a3454; /* –¢–æ–Ω–∫–∞—è —Ä–∞–º–∫–∞ */
        border-radius: 4px; /* –°–ª–µ–≥–∫–∞ —Å–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã */
        padding: 0;
        text-decoration: none;
        transition: 0.2s;
        height: 80px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
        overflow: hidden;
    }
    .tour-rect-card:hover {
        background: #1e2538;
        border-color: #4facfe;
    }

    /* –õ–µ–≤–∞—è —á–∞—Å—Ç—å (–ö–∞—Ä—Ç–∏–Ω–∫–∞) */
    .card-image-block {
        width: 120px;
        height: 100%;
        background: #0b0d17;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        border-right: 1px solid #2a3454;
    }
    .card-image-block img {
        width: 60%;
        height: 60%;
        object-fit: contain;
    }
    .grayscale { filter: grayscale(1); opacity: 0.5; }

    /* –¶–µ–Ω—Ç—Ä (–ù–∞–∑–≤–∞–Ω–∏–µ) */
    .card-center {
        flex-grow: 1;
        padding: 0 20px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .card-title {
        color: #fff;
        font-size: 1.1em;
        font-weight: bold;
        margin-bottom: 5px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .card-hashtags {
        display: flex;
        gap: 10px;
        font-size: 0.85em;
        color: #6a7b9c;
    }

    /* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å (–ò–Ω—Ñ–æ) */
    .card-right {
        display: flex;
        gap: 40px;
        padding-right: 30px;
        text-align: right;
    }
    .info-group {
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .info-group label {
        font-size: 0.75em;
        color: #556;
        margin-bottom: 2px;
    }
    .info-group span {
        color: #fff;
        font-size: 0.95em;
        font-weight: 500;
    }
    .prize-text { color: #fff; font-weight: bold; }

    /* –ê—Ä—Ö–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å */
    .archive-style {
        opacity: 0.8;
    }
    .empty-state { color: #556; padding: 20px; font-style: italic; }
</style>

<script>
    let activeFilters = new Set();

    function toggleFilter(tag, btn) {
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–ª–∞—Å—Å active –Ω–∞ –∫–Ω–æ–ø–∫–µ
        if (activeFilters.has(tag)) {
            activeFilters.delete(tag);
            btn.classList.remove('active');
        } else {
            // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –≤—ã–±–∏—Ä–∞–ª—Å—è –¢–û–õ–¨–ö–û –û–î–ò–ù —Ñ–∏–ª—å—Ç—Ä –∑–∞ —Ä–∞–∑, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ 2 —Å—Ç—Ä–æ–∫–∏:
            // activeFilters.clear(); 
            // document.querySelectorAll('.filter-pill').forEach(b => b.classList.remove('active'));
            
            activeFilters.add(tag);
            btn.classList.add('active');
        }
        applyFilters();
    }

    function resetFilters() {
        activeFilters.clear();
        document.querySelectorAll('.filter-pill').forEach(b => b.classList.remove('active'));
        applyFilters();
    }

    function applyFilters() {
        const cards = document.querySelectorAll('.tour-rect-card');
        
        cards.forEach(card => {
            if (activeFilters.size === 0) {
                // –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å—ë
                card.style.display = 'flex';
                return;
            }

            const cardTags = card.getAttribute('data-tags');
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∞ –•–û–¢–Ø –ë–´ –û–î–ò–ù –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤
            // (–ò–ª–∏ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å "–í—Å–µ —Ç–µ–≥–∏ —Å—Ä–∞–∑—É", —Ç–æ–≥–¥–∞ –ª–æ–≥–∏–∫–∞ –Ω–µ–º–Ω–æ–≥–æ –¥—Ä—É–≥–∞—è)
            let isVisible = false;
            activeFilters.forEach(filter => {
                if (cardTags.includes(filter)) isVisible = true;
            });

            if (isVisible) {
                card.style.display = 'flex';
            } else {
                card.style.display = 'none';
            }
        });
    }
</script>

<%- include('../partials/footer') %>
