<%- include('../partials/header') %>

<style>
    /* --- –®–ê–ü–ö–ê –¢–£–†–ù–ò–†–ê --- */
    .tour-header {
        text-align: center; margin-top: 40px; margin-bottom: 40px;
        background: radial-gradient(circle at center, rgba(22, 28, 48, 0.8) 0%, rgba(11, 13, 23, 1) 100%);
        padding: 40px 20px; border-bottom: 1px solid #2a3454;
    }
    .tour-title {
        font-family: 'Cinzel', serif; font-size: 3em; color: #d4af37;
        text-shadow: 0 0 20px rgba(212, 175, 55, 0.4); margin: 0;
    }
    .tour-meta { color: #8da4c4; margin-top: 10px; font-size: 1.1em; }

    /* --- –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô (Reg, Rules) --- */
    .action-row {
        display: flex; justify-content: center; gap: 20px; margin-top: 30px; flex-wrap: wrap;
    }
    .action-btn {
        padding: 12px 30px; border-radius: 4px; text-decoration: none; font-weight: bold;
        font-family: 'Segoe UI', sans-serif; text-transform: uppercase; transition: 0.3s;
        border: 1px solid transparent;
    }
    /* –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - –ó–æ–ª–æ—Ç–∞—è */
    .btn-reg {
        background: #d4af37; color: #000;
    }
    .btn-reg:hover { box-shadow: 0 0 20px rgba(212, 175, 55, 0.5); transform: translateY(-2px); }
    
    /* –ü—Ä–∞–≤–∏–ª–∞ - –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–µ/–°–∏–Ω–∏–µ */
    .btn-rules {
        background: rgba(79, 172, 254, 0.1); color: #4facfe; border-color: #4facfe;
    }
    .btn-rules:hover { background: #4facfe; color: #000; }

    /* --- –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ (TABS) --- */
    .tab-switcher {
        display: flex; justify-content: center; gap: 0; margin-bottom: 40px;
        border-bottom: 2px solid #2a3454; max-width: 600px; margin: 0 auto 40px auto;
    }
    .tab-btn {
        flex: 1; padding: 15px; background: transparent; border: none; color: #889;
        font-size: 1.2em; font-weight: bold; cursor: pointer; text-transform: uppercase;
        border-bottom: 3px solid transparent; transition: 0.3s;
    }
    .tab-btn:hover { color: #fff; }
    .tab-btn.active { color: #d4af37; border-bottom-color: #d4af37; }

    /* --- –ö–û–ù–¢–ï–ù–¢ --- */
    .content-section { display: none; max-width: 800px; margin: 0 auto; padding-bottom: 100px; }
    .content-section.active { display: block; }

    /* --- –õ–ï–ù–¢–ê –ù–û–í–û–°–¢–ï–ô (TG STYLE) --- */
    .news-post {
        background: #161c30; border: 1px solid #2a3454; border-radius: 12px;
        overflow: hidden; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    .news-img { width: 100%; height: auto; display: block; max-height: 500px; object-fit: cover; }
    .news-body { padding: 25px; }
    .news-text { 
        color: #ddd; font-size: 1.05em; line-height: 1.6; white-space: pre-wrap; /* –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∞–±–∑–∞—Ü—ã */
    }
    .news-date { color: #556; font-size: 0.85em; margin-top: 15px; text-align: right; }

    /* --- –°–ü–ò–°–û–ö –ú–ê–¢–ß–ï–ô --- */
    .match-item {
        display: flex; align-items: center; justify-content: space-between;
        background: #161c30; padding: 15px 25px; margin-bottom: 10px; border-radius: 8px;
        border: 1px solid #2a3454; text-decoration: none; transition: 0.2s;
    }
    .match-item:hover { transform: translateX(5px); border-color: #4facfe; }
    .match-names { color: #fff; font-weight: bold; font-size: 1.1em; }
    .match-vs { color: #556; margin: 0 10px; }
    .match-score { color: #d4af37; font-family: 'Cinzel', serif; }
</style>

<div class="tour-header">
    <div class="badge badge-soon" style="position: relative; top: -10px; display: inline-block; margin-bottom: 10px;">
        <%= tour.badgeText || 'OPEN' %>
    </div>
    <h1 class="tour-title"><%= tour.title %></h1>
    <div class="tour-meta">
        <span>Prize: <span style="color:#fff"><%= tour.prize || 'TBD' %></span></span> &nbsp;‚Ä¢&nbsp; 
        <span>Start: <span style="color:#fff"><%= tour.date || 'TBD' %></span></span>
    </div>

    <div class="action-row">
        <a href="<%= tour.regLink || '#' %>" target="_blank" class="action-btn btn-reg">REGISTRATION</a>
        <% if (tour.rulesLinkRu) { %>
            <a href="<%= tour.rulesLinkRu %>" target="_blank" class="action-btn btn-rules">üá∑üá∫ RULES</a>
        <% } %>
        <% if (tour.rulesLinkEn) { %>
            <a href="<%= tour.rulesLinkEn %>" target="_blank" class="action-btn btn-rules">üá∫üá∏ RULES</a>
        <% } %>
    </div>
</div>

<div class="tab-switcher">
    <button class="tab-btn active" onclick="showTab('news')">Announcements</button>
    <button class="tab-btn" onclick="showTab('matches')">Matches & Replays</button>
</div>

<div id="tab-news" class="content-section active">
    <% if (tour.announcements && tour.announcements.length > 0) { %>
        <% tour.announcements.slice().reverse().forEach(post => { %>
            <div class="news-post">
                <% if (post.image) { %>
                    <img src="/uploads/<%= post.image %>" class="news-img">
                <% } %>
                <div class="news-body">
                    <div class="news-text"><%= post.text %></div>
                    <div class="news-date"><%= new Date(post.date).toLocaleString() %></div>
                </div>
            </div>
        <% }); %>
    <% } else { %>
        <div style="text-align: center; color: #556; padding: 50px;">No updates yet. Check back later!</div>
    <% } %>
</div>

<div id="tab-matches" class="content-section">
    <% if (matches && matches.length > 0) { %>
        <% matches.forEach(m => { %>
            <a href="/game/<%= m.roomId %>" class="match-item">
                <div class="match-names">
                    <%= m.blueName %> <span class="match-vs">VS</span> <%= m.redName %>
                </div>
                <div class="match-score">
                    <% if (m.score) { %>
                        <%= m.score.blue %> - <%= m.score.red %>
                    <% } else { %>
                        WATCH
                    <% } %>
                </div>
            </a>
        <% }); %>
    <% } else { %>
        <div style="text-align: center; color: #556; padding: 50px;">No matches played yet.</div>
    <% } %>
</div>

<script>
    function showTab(tabName) {
        // –ö–Ω–æ–ø–∫–∏
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        
        // –°–µ–∫—Ü–∏–∏
        document.getElementById('tab-news').classList.remove('active');
        document.getElementById('tab-matches').classList.remove('active');
        
        document.getElementById('tab-' + tabName).classList.add('active');
    }
</script>

<%- include('../partials/footer') %>
