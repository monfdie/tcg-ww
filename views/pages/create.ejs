<script>
    const socket = io({ transports: ['websocket'] });
    
    const discordId = '<%= locals.user ? locals.user.id : "" %>';
    let myUserId = discordId || sessionStorage.getItem('draft_user_id') || Math.random().toString(36).substring(2);
    sessionStorage.setItem('draft_user_id', myUserId);

    function createGame() { 
        const nick = document.getElementById('nickname-input').value;
        const type = document.getElementById('draft-type-select').value;
        if(!nick) return alert("Введите никнейм!");
        
        sessionStorage.setItem('draft_nickname', nick);
        socket.emit('create_game', { nickname: nick, draftType: type, userId: myUserId }); 
    }

    function joinGame() {
        const room = document.getElementById('room-input').value.toUpperCase();
        const nick = document.getElementById('nickname-input').value;
        if(!room) return alert("Введите код комнаты!");
        if(!nick) return alert("Введите никнейм!");
        
        // Сохраняем настройки для страницы game.ejs
        sessionStorage.setItem('draft_nickname', nick);
        sessionStorage.setItem('join_as_spectator', document.getElementById('spectator-check').checked);
        
        window.location.href = `/game/${room}`;
    }

    socket.on('init_game', (data) => {
        sessionStorage.setItem('draft_room_id', data.roomId);
        window.location.href = `/game/${data.roomId}`;
    });
</script>
